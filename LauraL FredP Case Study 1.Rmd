---
title: "Case Study 01"
author: "Fred P"
date: "10/14/2019"
output:
  beamer_presentation: default
  powerpoint_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```
## Required Libraries
```{r}
library(tidyverse)
library(plotly)
```

## Question 1
```{r, fig.height=15, fig.width=15}

# get beers data
beers = read.csv(file.choose(), header = TRUE)
head(beers)

# get breweries data
breweries = read.csv(file.choose(), header = TRUE)
breweries = as_tibble(breweries)
head(breweries)

# group by state
breweries %>% ggplot(aes(State)) + 
    geom_bar(fill= "#127782") + 
    geom_text(stat="count", aes(label=..count..), hjust=-1, size=2.5) + 
    coord_flip()

# group by state continued.. 
breweries %>% 
  count(State, sort=TRUE) %>% 
  ggplot(aes(x = reorder(State, -n), y = n)) + 
    geom_bar(stat = "identity", fill = "#127782") +
    geom_text(aes(label = n), vjust = - 1)

# https://stackoverflow.com/questions/16961921/plot-data-in-descending-order-as-appears-in-data-frame

# testing data
mpg

```

## Question 2
```{r}

# I'm using an outer join to merge the data set
# outer join
bb = merge(beers,breweries, by.x = "Brewery_id", by.y = "Brew_ID", all=TRUE)

head(bb)
tail(bb)

```

## Question 3 - Address the missing values
Addressing the missing values 
Lost half (1005) our data due to absence of IBU (bitterness units) values. IBU is subjective and not required by breweries. Consumers care less about IBU. 
It's not a buying criteria for the end consumer. Not a true predictor of taste.
```{r}

# separating data set to omit na's
bb2 = na.omit(bb)

summary(bb2)

```

## Question 4 - Medians by state BAR CHART
Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.
```{r,fig.width = 15}

bb3 = bb
bb3$IBU = as.integer(replace_na(bb$IBU," "))
bb3$ABV = bb3$ABV * 100

bb3

bb2 %>% 
  group_by(State) %>% 
  summarize(medianABV = median(ABV) * 100, medianIBU = median(IBU)) %>%
  gather('medianABV','medianIBU', key = "category", value = "value") %>%
  ggplot(aes(x = reorder(State,-value), y = value)) +
    geom_bar(stat = "identity", aes(fill = category)) +
    geom_text(aes(label = value), angle = 90, hjust=-1)



## old
  arrange(desc(medianIBU)) %>% 
  ggplot(aes(x = State)) + 
    geom_bar(aes(fill = ))


# test data set
p <- data %>%
  mutate(gdpPercap=round(gdpPercap,0)) %>%
  mutate(pop=round(pop/1000000,2)) %>%
  mutate(lifeExp=round(lifeExp,1))

# test data continued..
data <- gapminder %>% filter(year=="2007") %>% dplyr::select(-year)

  # Most basic bubble plot
  data %>%
    arrange(desc(pop)) %>%
    mutate(country = factor(country, country)) %>%
    ggplot(aes(x=gdpPercap, y=lifeExp, size = pop)) +
      geom_point(alpha=0.5) +
      scale_size(range = c(.1, 24), name="Population (M)")
  
  ## https://www.r-graph-gallery.com/320-the-basis-of-bubble-plot.html

```

## Question 5
Which state has the maximum alcoholic (ABV) [Alcohol by Volume] beer? Which state has the most bitter (IBU) [International Bitterness Units] beer?
``` {r}

meanABV <- bb %>% 
  select(State, ABV) %>% 
  arrange(desc(ABV))

head(maxABV, n = 1)

maxIBU <- bb %>% 
  select(State, IBU) %>% 
  arrange(desc(IBU))

head(maxIBU,n = 1)

```

## Question 6
Comment on the summary statistics and distribution of the ABV variable.
```{r}
summary(bb$ABV)

bb$ABVPerc = bb$ABV * 100
bb2 %>% ggplot(aes(ABVPerc)) + geom_histogram(color = "#a2c16d", fill = "#b5d77a", bins= 51) + ggtitle("ABV Distribution") + ylab("Frequency") + xlab("ABV %")
head(maxABV, n = 10)

```

## Question 7
Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer.
```{r, fig.width=8, fig.height=8}

data.frame(table(unlist(str_split(tolower(bb2$Style)," ")))) %>% arrange(desc(Freq))

bb2$NewStyle = ifelse(grepl("lager", bb2$Style, ignore.case = TRUE), "Lager",
                      ifelse(grepl("india pale ale", bb2$Style, ignore.case = TRUE),"IPA",
                      ifelse(grepl("ipa", bb2$Style, ignore.case = TRUE),"IPA", 
                             ifelse(grepl("cider", bb2$Style, ignore.case = TRUE), "Cider",
                                    ifelse(grepl("ale",bb2$Style, ignore.case = TRUE), "Ale",
                                      ifelse(grepl("stout", bb2$Style, ignore.case = TRUE), "Porter/Stout",
                                             ifelse(grepl("pilsner", bb2$Style, ignore.case = TRUE), "Pilsner",
                                                    ifelse(grepl("pilsener", bb2$Style, ignore.case = TRUE), "Pilsner",
                                                           ifelse(grepl("porter", bb2$Style, ignore.case = TRUE), "Porter/Stout",
                                                                         ifelse(grepl("fruit", bb2$Style, ignore.case = TRUE), "Fruit/Herb",
                                                                                ifelse(grepl("herbed", bb2$Style, ignore.case = TRUE), "Fruit/Herb",
                                                                                       ifelse(grepl("hefeweizen", bb2$Style, ignore.case = TRUE), "Wheat",
                                                                                       ifelse(grepl("wheat", bb2$Style, ignore.case = TRUE), "Wheat","Other")))))))))))))
bb2 %>% filter(NewStyle == "Other")
bb2 %>% group_by(NewStyle) %>% count() %>% arrange(desc(n))

bb2 %>%
  ggplot(aes(x = ABV, y = IBU, color=NewStyle)) +
  geom_point() +
  ggtitle("ABV & IBU by Style of Beer")

bb2$freq <- as.numeric(ave(bb2$NewStyle, bb2$NewStyle, FUN = length))
bb2$ABVPerc = bb2$ABV * 100
bb2

p <- plot_ly(bb2, x = ~bb2$ABVPerc, y = ~bb2$NewStyle, z = ~bb2$IBU, color = ~bb2$NewStyle)%>%
  add_markers() %>%
  layout(scene = list(xaxis = list(title = "ABV"),
                      yaxis = list(title = "Style"),
                      zaxis = list(title = "IBU")))
p

```